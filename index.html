<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Live Tests</title>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
*{
  margin:0;
  padding:0;
  box-sizing:border-box;
  font-family:Arial, Helvetica, sans-serif;
}
body{ overflow-x:hidden; background:#0f172a; color:white; }

/* ===== LAYOUT ===== */
.content{ 
    display:flex; 
    min-height:100vh; }

/* ===== SIDEBAR ===== */
.sidebar{
  width:240px;
  background:#1e1e2f;
  height: 100vh;
  /* padding:10px; */
  overflow-x:hidden;
  overflow-y:auto;
}
/* ===== SIDEBAR SCROLLBAR DECORATION ===== */
.sidebar::-webkit-scrollbar {
    width: 8px;              /* scrollbar ki width */
}

.sidebar::-webkit-scrollbar-track {
    background: #1e1e2f;       /* track ka color (sidebar ke color se match) */
    border-radius: 10px;
}

.sidebar::-webkit-scrollbar-thumb {
    background: #87898ac7;     /* scrollbar ka color */
    border-radius: 10px;
}

.sidebar::-webkit-scrollbar-thumb:hover {
    background: #565758;       /* hover effect */
}

/* ===== FIREFOX SUPPORT ===== */
.sidebar {
    scrollbar-width: thin;           /* thin scrollbar */
    scrollbar-color: #434444c7 #1e1e2f;  /* thumb color | track color */
}


.sidebar h3{ margin-bottom:10px; }
.sidebar p{margin:15px;color:gray}
.sidebar ul{ list-style:none; }
.sidebar ul li{
  padding:15px;
  cursor:pointer;
  font-size:13px;
}
.sidebar ul li:hover{ background:#3095ddc7; }

/* ===== MAIN ===== */
.mainAndFooter{ flex:1; }

/* HEADER */
#mainNav{
  display:flex;
  justify-content:space-between;
  gap:10px;
  padding:10px 10px;
  /* background:#293235; */
}
#mainNav input{
  flex:1;
  padding:8px;
  border:none;
  /* width: 406px; */
  border-radius:5px;
  background: #ffffff;
}
#mainNav #getPass{
  padding:8px 14px;
  border:none;
  background:green;
  color:white;
  border-radius:5px;
}

#navigation{
    width:100%;
  display:flex;
  gap:30px;
  /* justify-content:space-between; */
  padding:10px 15px;
  background:#e5e5e5;
}

#navigation h4{
    cursor: pointer;
    color:black;
}

#navigation span{
  background:red;
  border-radius:5px;
  padding:5px 7px;
  font-size:13px;
  color:white;
}

.allTestList{
    display:flex;
    justify-content:center;
    gap:30px;
    padding:10px 0;
    align-items: center;
    /* background: red; */
}


.allTestList, button{
    border:none;
    outline: none;
    cursor: pointer;
    padding:6px;
    border-radius:5px;
    font-size:15px;
}

/* FILTER */
/* .allLiveTestsElement{
  padding:15px;
} */
.allLiveTestsElement{
  padding:15px;

  /* ‚úÖ CENTER FIX */
  max-width:1200px;     /* page ke beech me limit */
  margin:0 auto;        /* poora block center */
  /* background: blue; */
}

.allLiveTestsElement h3{
    margin-top:40px;
}
/* ===== LIVE TEST GRID ===== */
.allLiveTestContent{
  margin-top:30px;
  display:grid;
  grid-template-columns:repeat(auto-fit, minmax(280px, 300px));
  gap:20px;
  /* background: red; */
}


/* ===== CARD ===== */
.liveTestCard{
  background:#1e293b;
  padding:15px;
  border-radius:10px;
  box-shadow:0 4px 10px rgba(0,0,0,0.3);
  transition:.3s;
}
.liveTestCard:hover{
  transform:translateY(-4px);
}

.liveTestCard h3{
  font-size:16px;
  margin-bottom:8px;
}

.liveTestCard p{
  font-size:13px;
  color:#cbd5f5;
  margin:4px 0;
}

/* STATUS */
.liveTestStatus{
  display:inline-block;
  padding:4px 8px;
  border-radius:5px;
  font-size:12px;
  margin-bottom:6px;
}
.status-live{ background:#16a34a; }
.status-upcoming{ background:#f59e0b; color:black; }
.status-ended{ background:#dc2626; }

/* COUNTDOWN */
.liveCountdown{
  margin-top:6px;
  font-size:13px;
  color:#facc15;
  font-weight:bold;
}

/* USERS */
.liveUsers{
  margin-top:4px;
  font-size:12px;
  color:#38bdf8;
}

/* BUTTON */
.liveTestCard button{
  width:100%;
  margin-top:10px;
  padding:8px;
  border:none;
  border-radius:6px;
  background:#3095ddc7;
  color:white;
  cursor:pointer;
}
.liveTestCard button:hover{
  background:#1d4ed8;
}

/* MOBILE */
/* @media(max-width:768px){
  #mainNav{ flex-direction:column; }
} */

/* ================================================= */
/* ================= MOBILE FIX ==================== */
/* ================================================= */
@media (max-width:768px){

  /* üîí STOP LEFT‚ÄìRIGHT SCROLL */
  html, body{
    overflow-x:hidden;
  }


  /* ===== MAIN FULL WIDTH ===== */
  .mainAndFooter{
    width:100%;
  }

  /* ===== HEADER FIX ===== */
  #mainNav{
    flex-direction:column;
    flex-direction:row;        /* üî• column ‚Üí row */
    align-items:center;
    gap:8px;
    gap:10px;
    padding:10px 5px;
  }

  #mainNav input{
    flex:1;                    /* input bada, button chhota */
    width:auto;
  }

  #mainNav button{
    white-space:nowrap;        /* button wrap na ho */
  }

  #navigation{
    flex-wrap:wrap;
    gap:50px;
    justify-content:center;
  }

  /* ===== FILTER BUTTON CENTER ===== */
  .allTestList{
    flex-wrap:wrap;
    gap:15px;
    justify-content:center;
  }

  /* ===== CONTENT CENTER ===== */
  .allLiveTestsElement{
    padding:12px;
    max-width:100%;
  }

  /* ===== LIVE TEST GRID (2 CARD) ===== */
  .allLiveTestContent{
    display:grid;
    grid-template-columns:repeat(2, minmax(0,1fr));
    gap:12px;
  }

  /* ===== CARD FIX ===== */
  .liveTestCard{
    padding:12px;
    border-radius:8px;
  }

  .liveTestCard h3{
    font-size:14px;
  }

  .liveTestCard p{
    font-size:12px;
  }

  .liveTestCard button{
    font-size:13px;
    padding:7px;
  }
}

/* ================= MENU BUTTON ================= */
.menuBtn{
  display:none;
  background:none;
  border:none;
  font-size:22px;
  cursor:pointer;
}

.sidebarOverlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.45);
  z-index:999;
  display:none;
}

@media (max-width:768px){

  /* menu button show */
  .menuBtn{
    display:block;
    color: white;
    font-size: 30px;
  }

  /* sidebar hidden by default */
  .sidebar{
    position:fixed;
    top:0;
    left:0;
    z-index:1000;
    transform:translateX(-100%);
    transition:.3s;
  }

  .sidebar.active{
    transform:translateX(0);
  }

  .sidebarOverlay.active{
    display:block;
  }
}

/* ================= MOBILE ================= */



</style>
</head>

<body>



<div class="content">
  <!-- <div class="sidebar">
    <h3>Menu</h3>
    <ul>
      <li>Home</li>
    </ul>
  </div> -->
        <div class="sidebar">
            <h3>Menu</h3>

            <ul>
                <li onclick="loadPage('home.html')">Home</li>
            </ul>

            <p>Learn</p>
            <ul>
                <li>Maa Vidhya Coaching</li>
                <li>Live Classes</li>
                <li>Header Books</li>
            </ul>

            <p>Test</p>
            <ul>
                <li>Test Series</li>
                <li onclick="live()">Live Tests & Quizzes</li>
                <li>Previous Year Papers</li>
                <li>Practice</li>
                <li><a href="https://jpr-guddu.github.io/live-quiz/">Free Quizzes</a></li>
                <li>Attempted Tests</li>
                <li>Pass</li>
                <li>Pass Pro</li>
                <li>Pass Elite</li>
                <li>Rank Predictor</li>
            </ul>

            <p>Miscellaneous</p>
            <ul>
                <li>Exam</li>
                <li>Saved Questions</li>
                <li>Doubts</li>
                <li>GK & Current Affairs</li>
            </ul>
        </div>


  <div class="mainAndFooter">
    <div id="mainNav1">
      <div class="header1" id="mainNav">
        <button class="menuBtn" onclick="openSidebar()">‚ò∞</button>
        <input placeholder="Search Test">
        <button id="getPass">Get Pass</button>
      </div>
      
      <!-- <div class="header2" id="navigation">
        <h4>Daily Free <span>Live</span></h4>
        <h4>Attempted</h4>
      </div> -->
      
    </div>

    <div class="allLiveTestsElement">
      <!-- <div class="allTestList">
            <button>All Tests</button>
            <button>Pro Tests</button>
            <button>Elite Tests</button>
        </div>   -->
      <h3>Live Tests & Quizzes</h3>
      <div class="allLiveTestContent"></div>
    </div>
  </div>
</div>
<div class="sidebarOverlay" onclick="closeSidebar()"></div>
<script>
/* ===== FIREBASE CONFIG (APNA DALO) ===== */
const firebaseConfig = {
  apiKey: "AIzaSyA9jEFAe9gyM4Y8ijNq3I9UXfnpwTakrPc",
  authDomain: "mystorage-c9eeb.firebaseapp.com",
  databaseURL: "https://mystorage-c9eeb-default-rtdb.firebaseio.com",
  projectId: "mystorage-c9eeb",
  storageBucket: "mystorage-c9eeb.firebasestorage.app",
  messagingSenderId: "312232487382",
  appId: "1:312232487382:web:bf7d8c563030d0e682dc77"
};

/* üî• THIS LINE WAS MISSING */
firebase.initializeApp(firebaseConfig);

/* üî• NOW FIRESTORE */
const db = firebase.firestore();


/* ===== COUNTDOWN ===== */
function startCountdown(endTime, el){
  const timer = setInterval(()=>{
    const diff = endTime - Date.now();
    if(diff <= 0){
      el.innerText = "Time Over";
      clearInterval(timer);
      return;
    }
    const h = Math.floor(diff / 3600000);
    const m = Math.floor((diff % 3600000)/60000);
    const s = Math.floor((diff % 60000)/1000);
    el.innerText = `${h}h ${m}m ${s}s left`;
  },1000);
}

/* ===== LIVE USERS ===== */
function listenLiveUsers(quizId, el){
  db.collection("liveQuiz").doc(quizId)
    .collection("liveUsers")
    .onSnapshot(snap=>{
      el.innerText = `üë• ${snap.size} Live Users`;
    });
}

/* ===== LOAD QUIZZES ===== */
async function loadLiveTests(){
  const box = document.querySelector(".allLiveTestContent");
  box.innerHTML = "Loading...";

  const snap = await db.collection("liveQuiz").get();
  box.innerHTML = "";

  snap.forEach(async (docSnap)=>{
    const quizId = docSnap.id;
    const qc = docSnap.data().quizControl || {};

    /* ===== STATUS ===== */
    let status = "Upcoming";
    if(qc.active === true) status = "Live";
    if(qc.active === false && Date.now() > qc.endTime) status = "Ended";

    const statusClass =
      status==="Live" ? "status-live" :
      status==="Upcoming" ? "status-upcoming" :
      "status-ended";

    /* ===== QUESTIONS COUNT (‚úÖ FIX) ===== */
    const qSnap = await db
      .collection("liveQuiz")
      .doc(quizId)
      .collection("questions")
      .get();

    const qCount = qSnap.size;

    /* ===== CARD ===== */
    const card = document.createElement("div");
    card.className = "liveTestCard";

    card.innerHTML = `
      <h3>${quizId.toUpperCase()}</h3>
      <span class="liveTestStatus ${statusClass}">${status}</span>
      <p>üìò Questions: <b>${qCount}</b></p>
      <p>üïí Start: ${qc.startTime ? new Date(qc.startTime).toLocaleString("en-IN") : "-"}</p>
      <p>‚è∞ End: ${qc.endTime ? new Date(qc.endTime).toLocaleString("en-IN") : "-"}</p>
    `;

    /* ===== COUNTDOWN ===== */
    const countdown = document.createElement("div");
    countdown.className = "liveCountdown";
    if(status === "Live"){
      startCountdown(qc.endTime, countdown);
    }else{
      countdown.innerText = "Not Started";
    }
    card.appendChild(countdown);

    /* ===== LIVE USERS ===== */
    const users = document.createElement("div");
    users.className = "liveUsers";
    listenLiveUsers(quizId, users);
    card.appendChild(users);

    /* ===== BUTTON ===== */
    const btn = document.createElement("button");
    btn.innerText = status === "Live" ? "Join Now" : "View";

    btn.onclick = () => {
      if(status !== "Live"){
        alert("Quiz abhi live nahi hai");
        return;
      }
      window.location.href =
        "vimal.html?quizId=" + encodeURIComponent(quizId);
    };

    card.appendChild(btn);
    box.appendChild(card);
  });
}

function startQuiz(quizId, status){
  console.log("Starting quiz:", quizId); // debug

  if(status !== "Live"){
    alert("Quiz abhi live nahi hai");
    return;
  }
  // ‚úÖ GUARANTEED quizId pass
  window.location.href = "liveQuiz.html?quizId=" + encodeURIComponent(quizId);
}


function openSidebar(){
  document.querySelector(".sidebar").classList.add("active");
  document.querySelector(".sidebarOverlay").classList.add("active");
}

function closeSidebar(){
  document.querySelector(".sidebar").classList.remove("active");
  document.querySelector(".sidebarOverlay").classList.remove("active");
}




loadLiveTests();
</script>

</body>
</html>
